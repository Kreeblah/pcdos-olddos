@ECHO OFF

REM Check whether all options were passed
IF "%1" == "" GOTO MISSOPT
IF "%2" == "" GOTO MISSOPT

REM Check whether all the files exist on the disk
ECHO Checking that all DOS files are on the disk.
IF NOT EXIST CHKSTATE.SYS GOTO MISSDISK
IF NOT EXIST MD5SUM.EXE GOTO MISSDISK
IF NOT EXIST MEMMAKER.EXE GOTO MISSDISK
IF NOT EXIST MEMMAKER.HLP GOTO MISSDISK
IF NOT EXIST MEMMAKER.INF GOTO MISSDISK
IF NOT EXIST PRINT.EXE GOTO MISSDISK
IF NOT EXIST QBASIC.EXE GOTO MISSDISK
IF NOT EXIST QBASIC.HLP GOTO MISSDISK
IF NOT EXIST RESTORE.EXE GOTO MISSDISK
IF NOT EXIST SIZER.EXE GOTO MISSDISK
ECHO Found all the DOS files.

REM Check the integrity of files on the disk
ECHO Checking the integrity of the files on the disk.
MD5SUM -b -d 6548811e80d36d4976052e05e31742ed CHKSTATE.SYS > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d d11ca5b9e7de7c434b0812958e1081da MEMMAKER.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 2327811fca14b94779328982d65cae65 MEMMAKER.HLP > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d f746b7e9546e19269a4cfa738d73634d MEMMAKER.INF > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 240a48b46a5835d3c81dc58902eb567d PRINT.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d f84f0bf74b830603a29f77b11b9e4833 QBASIC.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 4d0b9e7d5a07d71723e725c2bb07fb82 QBASIC.HLP > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d d098d5fb90cd25fa95f588008df643fb RESTORE.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 03fe65eeada86c0cdbb26e74359e4d70 SIZER.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
ECHO All files on the disk have expected MD5 digests.

REM Check whether the directory specified exists
ECHO Checking that %1\%2 exists.
IF NOT EXIST %1\%2\COMMAND.COM GOTO MISSDOSDIR
ECHO Found %1\%2.

REM Check whether the installed files exist
ECHO Checking whether expected the DOS files already exist.
IF EXIST %1\%2\CHKSTATE.SYS GOTO NOTOLDDOS
IF EXIST %1\%2\MEMMAKER.EXE GOTO NOTOLDDOS
IF EXIST %1\%2\MEMMAKER.HLP GOTO NOTOLDDOS
IF EXIST %1\%2\MEMMAKER.INF GOTO NOTOLDDOS
IF EXIST %1\%2\PRINT.EXE GOTO NOTOLDDOS
IF EXIST %1\%2\QBASIC.EXE GOTO NOTOLDDOS
IF EXIST %1\%2\QBASIC.HLP GOTO NOTOLDDOS
IF EXIST %1\%2\RESTORE.EXE GOTO NOTOLDDOS
IF EXIST %1\%2\SIZER.EXE GOTO NOTOLDDOS
ECHO Didn't find any DOS files already at the target location.
GOTO DOINSTALL

:MISSOPT
ECHO OLDDOS file installer for PC-DOS
ECHO.
ECHO Usage:
ECHO %0 [DRIVE] [DOSDIR]
ECHO.
ECHO Example:
ECHO %0 C: DOS
GOTO END

:MISSDISK
ECHO Could not find one or more files on this disk.
ECHO Please ensure the following files are present on this disk and try again:
ECHO.
ECHO CHKSTATE.SYS
ECHO MD5SUM.EXE
ECHO MEMMAKER.EXE
ECHO MEMMAKER.HLP
ECHO MEMMAKER.INF
ECHO PRINT.EXE
ECHO QBASIC.EXE
ECHO QBASIC.HLP
ECHO RESTORE.EXE
ECHO SIZER.EXE
GOTO END

:BADDISK
ECHO One or more files on the disk does not have an expected MD5 digest.
ECHO Please check the files on the disk against the following digests
ECHO and place the correct files on this disk.
ECHO.
ECHO 6548811e80d36d4976052e05e31742ed *CHKSTATE.SYS
ECHO d11ca5b9e7de7c434b0812958e1081da *MEMMAKER.EXE
ECHO 2327811fca14b94779328982d65cae65 *MEMMAKER.HLP
ECHO f746b7e9546e19269a4cfa738d73634d *MEMMAKER.INF
ECHO 240a48b46a5835d3c81dc58902eb567d *PRINT.EXE
ECHO f84f0bf74b830603a29f77b11b9e4833 *QBASIC.EXE
ECHO 4d0b9e7d5a07d71723e725c2bb07fb82 *QBASIC.HLP
ECHO d098d5fb90cd25fa95f588008df643fb *RESTORE.EXE
ECHO 03fe65eeada86c0cdbb26e74359e4d70 *SIZER.EXE
GOTO END

:MISSDOSDIR
ECHO Could not locate the specified directory: %1\%2
ECHO.
GOTO MISSOPT

:NOTOLDDOS
ECHO One or more files at the install location already exists.
ECHO Please check the files in the directory and back them up
ECHO for replacement as needed.  The files tested for are:
ECHO.
ECHO %1\%2\CHKSTATE.SYS
ECHO %1\%2\MEMMAKER.EXE
ECHO %1\%2\MEMMAKER.HLP
ECHO %1\%2\MEMMAKER.INF
ECHO %1\%2\PRINT.EXE
ECHO %1\%2\QBASIC.EXE
ECHO %1\%2\QBASIC.HLP
ECHO %1\%2\RESTORE.EXE
ECHO %1\%2\SIZER.EXE
GOTO END

:DOINSTALL
ECHO Beginning installation.

ECHO Copying CHKSTATE.SYS
COPY CHKSTATE.SYS %1\%2 > NUL

ECHO Copying MEMMAKER.EXE
COPY MEMMAKER.EXE %1\%2 > NUL

ECHO Copying MEMMAKER.HLP
COPY MEMMAKER.HLP %1\%2 > NUL

ECHO Copying MEMMAKER.INF
COPY MEMMAKER.INF %1\%2 > NUL

ECHO Copying PRINT.EXE
COPY PRINT.EXE %1\%2 > NUL

ECHO Copying QBASIC.EXE
COPY QBASIC.EXE %1\%2 > NUL

ECHO Copying QBASIC.HLP
COPY QBASIC.HLP %1\%2 > NUL

ECHO Copying RESTORE.EXE
COPY RESTORE.EXE %1\%2 > NUL

ECHO Copying SIZER.EXE
COPY SIZER.EXE %1\%2 > NUL

ECHO Installation complete.

:END